var f=Object.defineProperty;var u=(n,t,s)=>t in n?f(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var i=(n,t,s)=>(u(n,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const m of e.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerPolicy&&(e.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?e.credentials="include":r.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(r){if(r.ep)return;r.ep=!0;const e=s(r);fetch(r.href,e)}})();class l{constructor(){i(this,"entities",new Set);i(this,"systems",new Map);i(this,"nextEntityId",[])}addEntity(t){this.entities.add(t)}addComponent(){}addSystem(t){const s=[];for(const o of this.entities)t.hasEntityRequiredComponents(o)&&s.push(o);this.systems.set(t,new Set(s))}update(t){for(const[s,o]of this.systems)s.update(o,t)}}const c=class c{constructor(){i(this,"id");i(this,"components",new Map);this.id=c.nextUUID,c.nextUUID++}attachComponent(t,s){return this.components.set(t,s),this}detachComponent(t){}getComponent(t){return this.components.get(t)}};i(c,"nextUUID",0);let d=c;class g{constructor(t,s,o){i(this,"ecs");i(this,"lastFrameTimestamp");i(this,"canvas");i(this,"ctx");i(this,"bgImage");i(this,"start",(t=0)=>{const s=t-this.lastFrameTimestamp;s/16>=1&&(this.ecs.update(s),this.lastFrameTimestamp=t),window.requestAnimationFrame(this.start)});this.ecs=t,this.lastFrameTimestamp=0,this.canvas=s,this.ctx=s.getContext("2d");const r=new Image;r.src=o,this.bgImage=r}stop(){}}class w{}class a extends w{constructor(s,o){super();i(this,"image");i(this,"direction");i(this,"currentFrame");i(this,"config");i(this,"spritewidth");i(this,"spriteHeight");i(this,"isLoaded");i(this,"frameRepetition");this.image=new Image,this.image.src=s,this.isLoaded=!1,this.spriteHeight=0,this.spritewidth=0,this.frameRepetition=0,this.isLoaded=!0,this.spriteHeight=this.image.height/4,this.spritewidth=this.image.width/6,this.direction="bottom",this.currentFrame=0,this.config=o}}class y{hasEntityRequiredComponents(t){for(const s of this.componentsRequired)if(!t.components.has(s))return!1;return!0}}class x extends y{constructor(s){super();i(this,"componentsRequired",new Set([a]));i(this,"ctx");this.ctx=s}update(s,o){for(const r of s){const e=r.getComponent(a);e&&(this.ctx.clearRect(0,0,600,300),this.ctx.drawImage(e.image,e.currentFrame*e.spritewidth,e.config.dirOffset[e.direction]*e.spriteHeight,e.spritewidth,e.spriteHeight,0,0,e.spritewidth,e.spriteHeight),e.frameRepetition===e.config.repetitions-1?(e.frameRepetition=0,e.currentFrame=e.config.frames==e.currentFrame+1?0:e.currentFrame+1):e.frameRepetition++)}}}const F=document.querySelector("#canvas"),p=new l,C=new d().attachComponent(a,new a("../public/zwierz.gif",{frames:5,xFrame:6,yFrame:4,repetitions:6,dirOffset:{bottom:0,left:1,right:2,top:3}}));p.addEntity(C);const h=new g(p,F,"../public/Forest_Retreat.webp");p.addSystem(new x(h.ctx));h.start();
